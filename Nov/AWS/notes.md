aws VPC

https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Scenario2.html

https://docs.aws.amazon.com/vpc/latest/userguide/configure-subnets.html

https://varunmanik1.medium.com/how-to-create-aws-vpc-in-10-steps-less-than-5-min-a49ac12064aa




lost keypair:
https://aws.amazon.com/premiumsupport/knowledge-center/ec2-user-account-cloud-init-user-data/





configure nginx as load balancer 
nginx will be listening in port 80

round robin, weighted algorithms are supported    

> healthcheck is also possible  

ssl termination (ssl off loading) available 
ssl will be installed at load balancer level 


> end to end encryption : The connection between user and load balancer will be encrypted with SSL. As well as connection between load balancer and backend server will be encrypted with SSL.    

> sticky session: load balancer will be directing the user to the same server as long as the session is valid    

> redis can be used to keep the session data and can avoid sticky sessoin for better load balancing  

webserver will be generating a session for each user login 
cookie: file contains session data  


hostinger 
redis, redis cluster 



linux virtual server > kernel level load balancing 



weighted > same conf 
public ip not needed
healthcheck protocol only http?





# 23 nov 2022



http request : data generated by browser
google http request headers 
data as key value pairs 
host: hostname
path: /(for default page) eg: /wp-contents/upload/etc
user-agent: client host and browser details 


tcp/ip stack in side kernel 
socket 
port
tcp packet : data generated by app > http request inside this tcp packet
client side port range
tcp vs udp 

contents of tcp packet 
source port 
destination port 
since the packet contains http header, it will direct the packet to port 80 in destination

ip packet encapsulate tcp/udp packet
ip packet contains 
source ip 
destiantion ip (got destination ip from dns)


how client machine identifies dns server ip?

ip packet is encapsulated by mac frame

when entering a wesite name in browser, the client machine first connect to 53 for name resolution 


netstat -ntlp : tcp 
netstat -nulp : udp

osi layer 
app layer : layer 7

check layers of clb, alb

layer 4 contains source port and dest port details 
layer 3 contains ip 
layer 2 mac 


router works in layer 3 
clb works in layer 4 
firewall works in layer 3 and layer 4 



> if clb working in layer 4 how it finds destination ip?

layer 7 data depends and varies between applications 
nacl and security groups work in layer 3 and 4

layer 3 and 4 have a predefined structre
layer 7 does not have a constant structure 
most layer 7 firewalls will be working in http only (http requests are easiest to read)


ip based virtual hosting vs name based 

httpd reads host field from http request to identify the virtual host 


how browser works 


httpd can block wget requests
wget can set useragent to avoid this 

clb cannot handle layer 7 data (cannot do name based resolution)
alb works in layer 7 (can read http data)


osi layer model vs tcp/ip layer model 


nlb and clb are in layer 4 ( clb also works in layer 7 http) 
alb in layer 7


clb may have more than 1 public ip 


if clb working in http layer 7, it can read and modify http packet (clb: http: 80 | instance : 80) :: this is why backend showing clb ip in logs 
if clb is in tcp mode, (clb : tcp: 80) clb cannot read/modify layer 7 data 
clb will encapsulate http header in tcp packet and will send to backend 

client request > igw > clb(private ip) > backend



name resolution in detail 
how process generates 
3way handshake 



how chown works 
how routers work
how modems work 
how switches work 


> does load balancer has route table entries?

clb can be multiple instances

alb is modified version of nginx 


dig lb dns 
lb can be already dns load balanced 
clb could be creating each instance in each subnet 



>>>
how clb identifies 
sticky session
session manager 
server load (ensures that no one server is overworked

https://www.nginx.com/resources/glossary/load-balancing/
https://avinetworks.com/what-is-load-balancing/







# 24 nov 2022








ec2 > images and templates > launch more like this

tcp health check will be faster 
http health check will be more reliable 


load balancer instances will be assigned per subnet 


route53 has multivalue answer
health check can be enabled for ips enabled in multivalue instance



log file log format edit



> modems are working in network layer, how do they replace source ip attached from brownser 

how xforward works?


in http mode clb will do this:
source ip from layer4 added as xforwarded field in layer 7 data 

we can only add xforwadedfor when using listeners with http. switching to tcp, the xforwarded tag will not be providing any data in the webserver logs. 











# 25 nov 2022



* Elastic file system (EFS)

single point of failiure  
io rates 
what if multiple writes are coming to same file 


cannot mention size while creating 
size of efs is 8 exabite


> efs vs ebs
ebs payment for size 
efs payment for usage



> mount issue
subnet access
sg 2049


